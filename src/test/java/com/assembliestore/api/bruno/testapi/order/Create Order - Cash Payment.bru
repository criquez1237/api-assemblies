meta {
  name: Create Order - Cash Payment
  type: http
  seq: 2
}

post {
  url: http://localhost:8081/api/orders
  body: json
  auth: bearer
}

auth:bearer {
  token: eyJhbGciOiJIUzUxMiJ9.eyJqdGkiOiJmNDA1Zjg4NC0yMjY3LTRiZjQtODFhYi0wYTRjMjU4YjYwZmYiLCJ1c2VyTmFtZSI6ImVranJpY25yaXUiLCJzdWIiOiJ0ZXN0MTRqQGV4YW1wbGUuY29tIiwiaWF0IjoxNzUzMTk5ODA5LCJleHAiOjE3NTMyODYyMDl9.MClsPbgHrjq0s0DncJdiUFhtUofjLal7bdQKDosInGLwsf66NFttXy0nheGaxEUlbr6kV3ZeGLQ0m2ZeEAqlrw
}

body:json {
  {
    "products": [
      {
        "productId": "prod789",
        "name": "AirPods Pro",
        "unitPrice": 249.99,
        "quantity": 2
      }
    ],
    "shippingAddress": {
      "street": "456 Oak Avenue",
      "city": "Los Angeles", 
      "country": "USA",
      "postalCode": "90210"
    },
    "paymentMethod": "CASH"
  }
}

tests {
  test("Response status is 201", function() {
    expect(res.getStatus()).to.equal(201);
  });
  
  test("Response has success message", function() {
    expect(res.getBody().success).to.equal(true);
  });
  
  test("Order total is correct", function() {
    expect(res.getBody().data.order.total).to.equal(499.98);
  });
  
  test("No clientSecret for cash payment", function() {
    expect(res.getBody().data.clientSecret).to.be.null;
  });
}
