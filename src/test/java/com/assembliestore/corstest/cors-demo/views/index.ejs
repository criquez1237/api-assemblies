<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Test CORS Productos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    .error { color: red; }
    .token { word-break: break-all; background: #eee; padding: 0.5em; }
    textarea { width: 100%; height: 200px; }
  </style>
</head>
<body>
  <h1>Test CORS Productos</h1>
  <form method="POST" action="/login">
    <label>Email: <input type="email" name="email" value="<%= email %>" required></label><br>
    <label>Password: <input type="password" name="password" value="<%= password %>" required></label><br>
    <button type="submit">Obtener Token</button>
  </form>
  <% if (token) { %>
    <div>
      <strong>Token JWT:</strong>
      <div class="token"><%= token %></div>
    </div>
    <form method="POST" action="/products">
      <input type="hidden" name="token" value="<%= token %>">
      <input type="hidden" name="email" value="<%= email %>">
      <input type="hidden" name="password" value="<%= password %>">
      <h3>Filtros Productos</h3>
      <label>Page: <input type="number" name="page" value="1"></label>
      <label>Limit: <input type="number" name="limit" value="10"></label>
      <label>Name: <input type="text" name="name"></label>
      <label>Min Price: <input type="number" step="0.01" name="minPrice"></label>
      <label>Max Price: <input type="number" step="0.01" name="maxPrice"></label>
      <button type="submit">Probar /products</button>
    </form>
  <% } %>
  <% if (products) { %>
    <h3>Respuesta /products</h3>
    <textarea readonly><%= JSON.stringify(products, null, 2) %></textarea>
  <% } %>
  <% if (error) { %>
    <div class="error">
      <h3>Error</h3>
      <pre><%= typeof error === 'string' ? error : JSON.stringify(error, null, 2) %></pre>
    </div>
  <% } %>
</body>
</html>
